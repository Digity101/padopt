"use strict";Array.prototype.getUnique=function(){for(var e={},n=[],t=0,o=this.length;o>t;++t)e.hasOwnProperty(this[t])||(n.push(this[t]),e[this[t]]=1);return n};var imageAnalysis=function(e,n,t,o){function r(e,n,t){return(e<<16|n<<8|t).toString(16)}function a(e,n,t){var o,r,a,l,i,s=Math.max(e,n,t),c=s-Math.min(e,n,t),f=function(e){return(s-e)/6/c+.5};return 0===c?l=i=0:(i=c/s,o=f(e),r=f(n),a=f(t),e===s?l=a-r:n===s?l=1/3+o-a:t===s&&(l=2/3+r-o),0>l?l+=1:l>1&&(l-=1)),{h:360*l+.5|0,s:100*i+.5|0,v:100*s+.5|0}}function l(){console.log("drawFinalResult"),console.log(g.join("")),S=document.createElement("canvas"),S.id="screenshot_canvas",document.body.appendChild(S),Caman(S,e,function(){this.resize({width:1024}).render(function(){var e=document.getElementById("screenshot_canvas"),n=e.getContext("2d");n.strokeStyle="#FFFF00",n.lineWidth=5,n.strokeRect(m[0],m[1],m[2]-m[0],m[3]-m[1]);for(var t=(m[2]-m[0])/F[0]/2,o=(m[3]-m[1])/F[1]/2,r=0;r<F[1];r++)for(var a=0;a<F[0];a++){var l=a*t*2+t+m[0],i=r*o*2+o+m[1],s=F[1]*r+a+r;n.fillStyle="#ffffff",n.font="36px Arial",n.fillText(g[s],l,i),n.strokeStyle="#FF0000",n.lineWidth=1,n.strokeText(g[s],l,i)}})})}function i(){p&&console.log("preProcessScreenshotForGemSampling"),S=document.createElement("canvas"),S.id="screenshot_canvas",p||(S.style="display:none"),document.body.appendChild(S);var n=x?30:60;Caman(S,e,function(){this.resize({width:1024}).stackBlur(n).render(v)})}function s(){p&&console.log("preProcessScreenshotForFindingGridBorder"),S=document.createElement("canvas"),S.id="screenshot_canvas",p||(S.style="display:none"),document.body.appendChild(S),Caman(S,e,function(){this.resize({width:1024}).threshold(20).render(d)})}function c(){p&&console.log("preProcessScreenshotForFindingShape"),y=[],S=document.createElement("canvas"),S.id="screenshot_canvas",p||(S.style="display:none"),document.body.appendChild(S),Caman(S,e,function(){this.resize({width:1024}).stackBlur(6).threshold(82).render(function(){var e=(m[2]-m[0])/F[0],n=(m[3]-m[1])/F[1];S=document.getElementById("screenshot_canvas");var o=S.getContext("2d");if(p){o.strokeStyle="#FFFF00",o.lineWidth=5,o.strokeRect(m[0],m[1],m[2]-m[0],m[3]-m[1]),o.fillStyle="#FF0000";for(var r=1;r<F[1];r++)o.fillRect(m[0],m[1]+n*r,m[2]-m[0],2);for(var a=1;a<F[0];a++)o.fillRect(m[0]+e*a,m[1],2,m[3]-m[1])}for(var l,s,c,d,u,v,r=0;r<F[1];r++)for(var a=0;a<F[0];a++)v=6==t?17:19,l=a*e+e/2+m[0],s=r*n+n/v+m[1],c=h(l,s,!0),l=a*e+e/19+m[0],s=r*n+n/19+m[1],d=h(l,s,!0),l=a*e+e/11+m[0],s=r*n+n/11+m[1],u=h(l,s,!0),!c&&d&&u?y.push("o"):y.push("?");f(),i()})})}function f(){var e=document.getElementById("screenshot_canvas");e&&e.parentElement.removeChild(e)}function h(e,n,t){S=document.getElementById("screenshot_canvas");var o=S.getContext("2d"),a=o.getImageData(e,n,1,1).data,l=("000000"+r(a[0],a[1],a[2])).slice(-6);return"000000"==l?(p&&t&&(o.fillStyle="#FF0000",o.fillRect(e,n,2,2)),!0):(p&&(o.fillStyle="#FF0000",o.fillRect(e,n,1,1)),!1)}function d(){function e(e,n,t,o){for(;e>0;){if(h(e,n)){for(var r=n-c,l=!0;n>r;){if(!h(e,r)){l=!1;break}r+=a}if(l)return e+2}e-=a}return 0}function n(e,n,t,o){for(;t>e;){if(h(e,n)){for(var r=n-c,l=!0;n>r;){if(!h(e,r)){l=!1;break}r+=a}if(l)return e-2}e+=a}return t}function t(e,n,t){var o=(t-e)/F[0];return o*F[1]+n}function r(e,n,t,o){for(;n>0;){if(h(e,n)){for(var r=e-c,l=!0;e>r;){if(!h(r,n)){l=!1;break}r+=a}if(l)return n}n-=a}return null}p&&console.log("findGrid");var a=2;S=document.getElementById("screenshot_canvas");var l=S.width,s=S.height,c=l/4,d=2*c,u=s/4*3,v=e(d,u,l,s),g=n(d,u,l,s),y=r(v+c,u,l,s);m=[v,y,g,t(v,y,g)],f(),null==m[0]||null==m[1]||null==m[2]||null==m[3]?o(!1):i()}function u(e,n,t){var o=0;return x&&(o=1,t&&(o=2)),e.h>=C[o][0]&&C[o][1]>=e.h&&e.v>=C[o][2]&&C[o][3]>=e.v&&(!x||x&&"o"===y[n])?"r":e.h>=_[o][0]&&_[o][1]>=e.h&&e.v>=_[o][2]&&_[o][3]>=e.v&&(!x||x&&"o"===y[n])?"b":e.h>=E[o][0]&&E[o][1]>=e.h&&e.v>=E[o][2]&&E[o][3]>=e.v&&(!x||x&&"o"===y[n])?"g":e.h>=k[o][0]&&k[o][1]>=e.h&&e.v>=k[o][2]&&k[o][3]>=e.v&&(!x||x&&"o"===y[n])?"y":e.h>=I[o][0]&&I[o][1]>=e.h&&e.v>=I[o][2]&&I[o][3]>=e.v&&(!x||x&&"o"===y[n])?"p":e.h>=R[o][0]&&R[o][1]>=e.h&&e.v>=R[o][2]&&R[o][3]>=e.v&&(!x||x&&"?"===y[n])?"h":e.h>=b[o][0]&&b[o][1]>=e.h&&e.v>=b[o][2]&&b[o][3]>=e.v&&(!x||x&&"?"===y[n])?"j":e.h>=B[o][0]&&B[o][1]>=e.h&&e.v>=B[o][2]&&B[o][3]>=e.v?"q":e.h>=w[o][0]&&w[o][1]>=e.h&&e.v>=w[o][2]&&w[o][3]>=e.v?"w":"x"}function v(){p&&console.log("sampleEachGem");var e=[],n=0;S=document.getElementById("screenshot_canvas");for(var t,r,i,s,h,d=S.getContext("2d"),v=(m[2]-m[0])/F[0]/2,C=(m[3]-m[1])/F[1]/2,k=0;k<F[1];k++){h=k%2===0;for(var E=0;E<F[0];E++)x?(t=E*v*2+2*v/3+m[0],r=k*C*2+2*v/3*2+m[1]):(t=E*v*2+v+m[0],r=k*C*2+v+m[1]),i=d.getImageData(t,r,1,1).data,s=u(a(i[0],i[1],i[2]),n,h),(p||"x"==s)&&console.log(k+1,E+1,a(i[0],i[1],i[2]),s,y?y[n]:null,h),p&&(d.fillStyle="#ffffff",d.font="30px Arial",d.fillText(s,t,r)),e.push(s),n+=1,h=!h}g=e,f();var _=g.getUnique().sort();!x&&(1===_.length&&"x"===_[0]||2===_.length&&"j"===_[0]&&"x"===_[1])?(p&&console.log("go dark mode"),x=!0,c()):p?l():o(g.join(""))}var m,g,y,p=!1,F=[n,t],x=!1,S=null,C=[[5,15,15e3,26e3],[1,15,1e4,25e3],[2,15,5e3,15e3]],k=[[45,60,15e3,26e3],[30,40,1e4,25e3],[30,40,5e3,15e3]],E=[[125,150,15e3,26e3],[50,85,5e3,15e3],[90,130,5e3,15e3]],_=[[195,215,18e3,26e3],[225,285,5e3,15e3],[215,255,5e3,15e3]],b=[[205,225,8e3,17999],[1,15,7e3,1e4],[330,340,4e3,1e4]],w=[[268,275,15e3,25e3],[5,15,3e4,3e4],[3,15,3e4,3e4]],B=[[276,284,15e3,21e3],[5,15,9e3,15e3],[346,360,5e3,1e4]],I=[[285,300,15e3,26e3],[325,345,1e4,15e3],[305,329,5e3,15e3]],R=[[315,330,15e3,26e3],[340,350,1e4,25e3],[330,345,5e3,15e3]];p&&($("#contentHolder").hide(),$("body").css("overflow","auto")),f(),s()};